<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dao.PetitionCommentDAO">

	<!-- 모든 댓글 조회 -->
	<select id="selectAllCommentsByPetitionId" resultType="petitionCommentVO">
    SELECT COMMENT_ID as COMMENTID,
           PETITION_ID as PETITIONID,
           USER_ID as userId,
           PARENT_COMMENT_ID as PARENTCOMMENTID,
           CONTENT,
           CREATED_AT as CREATEDAT
    FROM TB_PETITION_COMMENTS
    WHERE PETITION_ID = #{petitionId}
    ORDER BY 
        NVL(PARENT_COMMENT_ID, COMMENT_ID), -- 부모 댓글 ID가 NULL이면 자신의 ID로 정렬
        CREATED_AT                         -- 같은 계층에서 생성일 순으로 정렬
</select>




	<!-- 특정 댓글 조회 -->
	<select id="selectCommentById" resultType="petitionCommentVO">
		SELECT COMMENT_ID as
		COMMENTID, PETITION_ID as PETITIONID, USER_ID as
		userId,
		PARENT_COMMENT_ID as PARENTCOMMENTID, CONTENT, CREATED_AT as
		CREATEDAT
		FROM TB_PETITION_COMMENTS
		WHERE COMMENT_ID = #{commentId}
	</select>

	<!-- 댓글 삽입 -->
	<insert id="insertComment" parameterType="petitionCommentVO">
		INSERT INTO
		TB_PETITION_COMMENTS (COMMENT_ID, PETITION_ID, USER_ID as
		userId,
		PARENT_COMMENT_ID, CONTENT, CREATED_AT)
		VALUES (SEQ_COMMENT_ID.NEXTVAL,
		#{petitionId}, #{userId},
		#{parentCommentId}, #{content}, SYSDATE)
	</insert>

	<!-- 댓글 업데이트 -->
	<update id="updateComment" parameterType="petitionCommentVO">
		UPDATE
		TB_PETITION_COMMENTS
		SET CONTENT = #{content}
		WHERE COMMENT_ID =
		#{commentId}
	</update>

	<!-- 댓글 삭제 -->
	<delete id="deleteComment" parameterType="long">
		DELETE FROM
		TB_PETITION_COMMENTS WHERE COMMENT_ID = #{commentId}
	</delete>

	<!-- 대댓글 삽입 -->
	<insert id="insertReplyComment"
		parameterType="petitionCommentVO">
		INSERT INTO TB_PETITION_COMMENTS (COMMENT_ID,
		PETITION_ID, USER_ID,
		PARENT_COMMENT_ID, CONTENT, CREATED_AT)
		VALUES
		(SEQ_COMMENT_ID.NEXTVAL, #{petitionId}, #{userId},
		#{parentCommentId},
		#{content}, SYSDATE)
	</insert>


</mapper>
